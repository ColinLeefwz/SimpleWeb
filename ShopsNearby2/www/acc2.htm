<!DOCTYPE html>
<html>
    <head>
        <title>Acceleration Example</title>
        
        <script type="text/javascript" charset="utf-8" src="cordova-1.5.0.js"></script>
        <script type="text/javascript" charset="utf-8">
            
            // The watch id references the current `watchAcceleration`
            var watchID = null;
            var oldx,oldy,oldz,oldt;
            var yiy_status="init";
            
            // Wait for PhoneGap to load
            //
            document.addEventListener("deviceready", onDeviceReady, false);
            
            // PhoneGap is ready
            //
            function onDeviceReady() {
                startWatch();
            }
            
            // Start watching the acceleration
            //
            function startWatch() {
                
                // Update acceleration every 3 seconds
                var options = { frequency: 500 };
                
                watchID = navigator.accelerometer.watchAcceleration(onSuccess, onError, options);
                alert(watchID);
            }
            
            // Stop watching the acceleration
            //
            function stopWatch() {
                if (watchID) {
                    navigator.accelerometer.clearWatch(watchID);
                    watchID = null;
                }
            }
            
            // onSuccess: Get a snapshot of the current acceleration
            //
            function report(acceleration){
                var element = document.getElementById('accelerometer');
                element.innerHTML = 'Acceleration X: ' + acceleration.x + '<br />' +
                'Acceleration Y: ' + acceleration.y + '<br />' +
                'Acceleration Z: ' + acceleration.z + '<br />' + 
                'Timestamp: '      + acceleration.timestamp + '<br />'+
                'status:' + yiy_status;
            }
            function diff(acceleration){
                var ret = Math.abs(acceleration.x - oldx)+Math.abs(acceleration.y - oldy)+ Math.abs(acceleration.z - oldz);
                //alert(ret);
                var element = document.getElementById('diff');
                element.innerHTML = 'diff X: ' + (acceleration.x-oldx)*1 + '<br />' +
                'diff Y: ' + (acceleration.y-oldy)*1 + '<br />' +
                'diff Z: ' + (acceleration.y-oldz)*1 + '<br />' + 
                'Timestamp: '      + (acceleration.timestamp-oldt)*1 + '<br />' +
                'diff: ' + ret +'<br />';
                return ret;
            }
            function onSuccess(acceleration) {
                if(yiy_status=="init"){
                    oldx=acceleration.x;
                    oldy=acceleration.y;
                    oldz=acceleration.z
                    oldt=acceleration.timestamp;
                    yiy_status="listen";
                }else if(yiy_status=="listen"){
                    if(diff(acceleration)>1){
                        yiy_status="active"
                    }
                    oldx=acceleration.x;
                    oldy=acceleration.y;
                    oldz=acceleration.z
                    oldt=acceleration.timestamp;
                }else if(yiy_status=="active"){
                    if(diff(acceleration)>1){
                        yiy_status="done";
                        my_media = new Media("./roar.mp3");
                        my_media.play();
                        //document.getElementById("aid").play();
                        //stopWatch();
                    }else{
                        //if(acceleration.timestamp-oldt>1000) yiy_status="init";
                        oldx=acceleration.x;
                        oldy=acceleration.y;
                        oldz=acceleration.z
                        oldt=acceleration.timestamp;
                    }
                }
                report(acceleration);
            }
            
            // onError: Failed to get the acceleration
            //
            function onError() {
                alert('onError!');
            }
            
            </script>
    </head>
    <body>
        <div id="accelerometer">Waiting for accelerometer...</div>
        <div id="diff"></div>
        <button onclick="stopWatch();">Stop Watching</button> <br/>
        <button onclick="yiy_status='init';">reset Watching</button> <br/>
        <br/>

        <audio style="display:inline" src="./roar.mp3" preload="auto" id="aid" controls>
        </audio>
        
        <br />
        <a href="index.html">index</a>
    </body>
</html>