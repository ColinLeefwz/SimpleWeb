
<div class="subtitle">员工列表</div>

<table width="100%" border="0" cellpadding="0" cellspacing="0" class="tab">
  <tr>
    <th width="20%" class="first">姓名</th>
    <th width="20%">性别</th>
    <th width="20%" align="center">生日</th>
    <th width="20%" align="center">签到次数</th>
    <th width="20%" align="center"></th>

  </tr>
  <% @staffs.each do |staff| %>
    <tr>
      <td class="gray"><%= staff.user.try(:name) %></td>
      <td align="center" class="gray"><%= staff.user.try(:show_gender) %></td>
      <td align="center" class="gray"><%= staff.user.try(:birthday).try(:to_date) %></td>
      <td align="center" class="gray"><%=link_to staff.checkin_count(staff.user_id),"/shop_checkins?uid=#{staff.user_id}" %></td>
      <td align="center" class="gray"><%=link_to '删除', '#' , :onclick => "ajaxDeleteStaff($(this), '#{staff.id}');" %></td>
  </tr>
<% end %>

  <tr class="bottom">
    <td align="left"><%= link_to '从签到人中添加', "/shop_staffs/new" %></td>
    <td colspan="3" align="right">
    <%= generate_paginate.html_safe %>
    </td>
  </tr>
</table>

<script type="text/javascript">
  function ajaxDeleteStaff(obj, id){
    if(confirm("确定删除该员工？"))
      $.post("/shop_staffs/ajax_delete_staff",{id: id}, function() {
        obj.parent().parent().remove();
      });
  }

</script>