<div class="title2"><h2>优惠券管理</h2></div>
<a href="/shop_coupons/new" class="btn4 l mt10">签到类发布</a>
<a href="/shop_coupons/new2" class="btn5 l ml15 mt10">分享类发布</a>

<table width="100%" border="0" cellpadding="0" cellspacing="0" class="tab">
  <tr>
    <th width="40%" align="left" colspan="2">标题</th>
    <th width="10%">类型</th>
    <th width="9%" align="center">已下载</th>
    <th width="9%" align="center">已使用</th>
    <th align="center">操作</th>
  </tr>

  <% @coupons.each do |coupon| %>

    <tr>
      <td width="10%"><%=image_tag coupon.img.url(:t1) %></td>
      <td valign="center" width="30%"><%= coupon.name %></td>
      <td class="gray f12" align="center"><%= coupon.show_t2  %></td>
      <td align="center"><%= link_to coupon.users.to_a.count, {:action => 'users', :id => coupon.id, :flag => 'down'} %></td>
      <td align="center"><%= link_to coupon.users.to_a.count{|s| s['uat']},{:action => 'users', :id => coupon.id, :flag => 'use'} %></td>
      <td align="center">
        <a href="#"><%= link_to '详情', shop_coupon_path(coupon) %></a>
        <a href="#"><%=link_to '编辑', edit_shop_coupon_path(coupon) if coupon.users.blank? %></a>
        <a href="#"><%= coupon.hidden ==1 ? '已停用' : (link_to '停用', '#', :onclick => "ajaxDeply($(this), '#{coupon.id}')") %></a>
        <a href="#"><%= (link_to '删除', '#', :onclick => "ajaxDel($(this), '#{coupon.id}')") if coupon.users.blank? %></a>
      </td>
    </tr>

  <% end %>
</table>
<div class="pages mt15">
  <%= generate_paginate.html_safe %>
</div>


<script type ="text/javascript">
  LeftMenu(6);
  function ajaxDeply(obj, coupon_id){
    if(confirm("确定停用此优惠券么？"))
    {
      $.get("/shop_coupons/ajax_deply",{id: coupon_id}, function(data) {
        obj.replaceWith(data['text'])
      });
    }
  }
  function ajaxDel(obj, coupon_id){
    if(confirm("确定删除此优惠券么？"))
    {
      $.get("/shop_coupons/ajax_del",{id: coupon_id}, function(data) {
        if(data['text']){
          obj.parent().parent().remove();
        }
        else{
          obj.replaceWith('删除失败.')
        }
      });
    }
  }
</script>




