<!DOCTYPE>
<html>
<head>
<meta name="viewport" content="width=100%, initial-scale=0.5, user-scalable=0.5, minimum-scale=0.5, maximum-scale=0.5" />

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="apple-itunes-app" content="app-id=577710538,app-argument=dface://login/" />
<meta http-equiv="mobile-agent" content="format=xhtml; url=http://dface.cn/mini.html" />
<title><%= @zwyd_wish.photo_user.try(:name) %>çš„2014å¿ƒæ„¿, æˆ‘ä»¬ä¸€èµ·å¿«å»ç¥ç¦å§ï¼</title>
<link rel="stylesheet" href="w/1/css/public.css" type="text/css" media="screen"/>
<script src="w/1/js/jquery-1.6.2.min.js" language="javascript" type="text/javascript"></script>
<script>
	$(document).ready(function(){
    var zwyd_total = $("#zwyd_wish_total").html()
    var zwyd_skip = 20
		$("#name").click(function(){
			if($(this).val()=="ç¥ç¦äºº"){
				$(this).val("");
			}
		});
		$("#wish").click(function(){
			if($(this).val()=="ç¥ç¦è¯­"){
				$(this).val("");
			}
		});
		
		$("#More").click(function(){
      if(zwyd_skip >= zwyd_total){
        return
      }
	  var libox="";
      var id = $("#zwyd_wish_id").val()
        $.get('/zwyd_wish/ajax_wish',{id: id, total: zwyd_total, skip: zwyd_skip }, function(data){
            for(var i=0;i<data.length;i++){
              libox +='<li><a>'
              libox += data[i]
              libox +='</a></li>';
            }
            $("#Mes").append(libox);
            zwyd_skip += data.length
            if(zwyd_skip >= zwyd_total){
              $("#More").remove();
            }
        });	
		});
		var timer,timer2,timer3;
		$("#Btn").click(function(){
		   
			var n=$("#name").val(),
				w=$("#wish").val();
			if(n==""||n=="ç¥ç¦äºº"||w==""||w=="ç¥ç¦è¯­"){
				return false;
			}
			var id = $("#zwyd_wish_id").val()
			$.get("/zwyd_wish/create",{name: n, wish: w, id:id }, function(){
					var i=0;
					$("#Mes li").removeClass("new");
					$("#Mes li a").removeAttr("style");
					var mes="<li class='new'><a>"+n+"ï¼š"+w+"</a></li>";
					$("#Mes").prepend(mes);
					$("#name").val("ç¥ç¦äºº"); $("#wish").val("ç¥ç¦è¯­");
					clearInterval(timer);
					clearTimeout(timer2);
					clearTimeout(timer3);
					timer=setInterval(function(){
						switch(i){
							case 0: $("#Mes li.new a").css({"color":"#FF1E1E","font-size":"30px"});break;
							case 1: $("#Mes li.new a").css({"color":"#3232FF","font-size":"30px"});break;
							case 2: $("#Mes li.new a").css({"color":"#bbb","font-size":"30px"});i=-1;break;
						}
						i++;
					},1000);
					timer2=setTimeout(function(){
						var bghigh=$(document).scrollTop()+($(window).height()-160)/2;
						var bgleft=$(document).scrollLeft()+($(window).width()-450)/2;

						$("#BG").css({"top":bghigh+"px","left":bgleft+"px"});
						$("#BG").fadeIn(500);
					},250);
					timer3=setTimeout(function(){
						$("#BG").fadeOut(500);
					},3000);
				})
		});
		$("#BG").click(function(){
			$("#BG").fadeOut(500);
		});
		$("#SmallPic").click(function(){
			$("#BigPic").fadeIn(500,function(){
				$("#Main").css("width",$(this).width()+"px");
			});
		});
		$("#BigPic").click(function(){
			$("#BigPic").fadeOut(500,function(){
				$("#Main").css("width","640px");
			});
		});
	});
</script>
</head>

<body>

<div id="Main"><%= image_tag "http://s.dface.cn/zw#{params[:id]}.jpg" , :id=>"BigPic" %>
<div class="con2">
<a id="BG">è°¢è°¢<img src="/w/1/images/sign2.png"/>æ”¶åˆ°ä½ çš„ç¥ç¦å•¦<img src="/w/1/images/sign3.png"/></a>
  <div class="header2"><img src="/w/1/images/header2.png"/></div>
  <div class="con">
    <div class="plane2">
      <div class="imgsbox">
        <%= image_tag "http://s.dface.cn/zw#{params[:id]}.jpg" , :class => "imgs pointer", :id=>"SmallPic" %>
        <img class="imgs2" src="w/1/images/pic3.png">
      </div>
      <div class="content">
        <div class="tit">
          <%= image_tag @zwyd_wish.user_logo, :align => "absbottom" %>
          <h2><a><%= @zwyd_wish.photo_user.try(:name) %></a>çš„å¿ƒæ„¿ï¼š</h2>
        </div>
        <p><%= @zwyd_wish.photo_desc %></p>
        <div class="op">
          <b class="l">æ”¶åˆ°<%= @zwyd_wish.total %>ä¸ªç¥ç¦</b>
          <!--<a class="r" href="#">ç¥ç¦ä»–</a>-->
        </div>
      </div>
    </div>
	<a name="a1"></a>
    <div class="plane3">
      <a class="links" target="_blank" href="/w/zwyd/explain2.html">æ´»åŠ¨è¯¦æƒ…</a>
      <div class="l">æˆ‘å·²ç»æ”¶åˆ° <span class="red" id='zwyd_wish_total'><%= @zwyd_wish.total %></span>ä¸ªç¥ç¦å•¦<br/>
		<%if @zwyd_wish.total.to_i<30 %>  
		  <span class="red">è¿˜å·®<%= (30- @zwyd_wish.total.to_i) < 0 ? 0: (30- @zwyd_wish.total.to_i)   %>ä¸ªç¥ç¦å°±æœ‰æœºä¼šæ‹¿åˆ°1000å…ƒæ–°å¹´çº¢åŒ…å•¦ï¼Œ<br/>èµ¶ç´§ç¥ç¦æˆ‘å™¢~</span>
		<%else%>
		  <span class="red">ä½ çš„äººæ°”çˆ†æ£šï¼30ä¸ªç¥ç¦å·²ç»é›†æ»¡ï¼æ­£å¼åŠ å…¥åƒå…ƒçº¢åŒ…æŠ¢å¤ºå¤§å†›å•¦ï¼ç¥ç¦è¶Šå¤šï¼Œä¸­å¥–å‡ ç‡è¶Šé«˜å™¢ğŸ˜‰</span>
		<%end%>		  
	  </div>
    </div>
    <div class="plane4">
      <ul id="Mes">
        <% @zwyd_wish.data.reverse[0,20].each do |da| %>
         <li>
          <a><%= da.join(': ') %></a>
         </li>
        <% end %> 
      </ul>
      <div class="clear1"></div>
      <% if @zwyd_wish.data.length > 20%>
      <a class="r mr30 pointer" id="More">æŸ¥çœ‹æ›´å¤š</a>
      <% end %>
    </div>
    <div class="plane5">
      <div class="title1">ç¥ç¦TAï¼š</div>
        <%= hidden_field_tag :id, params[:id], :id => "zwyd_wish_id" %>
        <div class="inputbox1">
          <%= text_field_tag :name, params[:name]||'ç¥ç¦äºº', :class => "texts" %>
        </div>
        <div class="inputbox2">
            <%= text_area_tag :wish, params[:wish]|| 'ç¥ç¦è¯­'%>
        </div>
        <div class="clear1"></div>
        <a href="#a1" class="btn r mb30" id="Btn"></a>
    </div>
  </div>
  <a href="http://www.dface.cn/mini.html" target="_blank"><img src="w/1/images/ad1.jpg" width="100%" class="mt10 mb30"/></a>
</div>
</div>
</body>
</html>
