<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>紫薇原点祈福活动</title>
<link rel="stylesheet" href="/w/1/css/public.css" type="text/css" media="screen"/>
<script src="/w/1/js/jquery-1.6.2.min.js" language="javascript" type="text/javascript"></script>
<script src="/w/1/js/jquery.blocksit.min.js" language="javascript" type="text/javascript"></script>
<script>
// JavaScript Document
$(document).ready(function(){
	var zwydSkip=0
	
	var windowWidth=$(window).width();
	if(windowWidth<=1280){
		$("#Waterfall").css({"width":"928px"});
		num=3;
		
	}else{
		$("#Waterfall").css({"width":"1236px"});
		num=4;
	}

	var high=window.screen.height,
		scrollheight=0;
	/** high 存放屏幕高度， scrollTop 存放页面滚动高度。**/

	$(parent.window).scroll(function(){//页面滚动时执行此函数
		if(scrollheight<$(parent.window).scrollTop()){
			scrollheight=$(parent.window).scrollTop();
			ADDItems();
		}		
		// 另一种情况 若 scrollheight > $(parent.window).scrollTop() 表示页面向上滚动。那么页面的整体高度就不会再增加。
	});

	

	
	function ADDItems(){//增加框架函数
		var row=1;
		$.get("/zwyd_wish/list.json", {skip: zwydSkip}, function(data){

		while($(".box").height()<(high+scrollheight)&& row <= 1){
				for(var i=0; i < 3; i++){
					alert(data[i])
					var itemplane='<div class="plane">'
								+'<div class="imgsbox">'
									+'<img class="imgs" src="'+ data[i]['photo_url'] +'">'
									+'<img class="imgs2" src="/w/1/images/pic3.png">'
								+'</div>'
								+'<div class="content">'
									+'<div class="tit">'
										+'<img src="'+data[i]['user_logo']+'" align="absbottom"/>'
										+'<h2><a href="#">'+ data[i]['user_name'] +'</a>的心愿：</h2>'
									+'</div>'
									+'<p>'+ data[i]['photo_desc'] +'</p>'
									+'<div class="op">'
										+'<b class="l">收到'+ data[i]['total'] +'个祝福</b>'
										+'<a class="r" href="#">祝福他</a>'
									+'</div>'
								+'</div>'
							+'</div>';
							alert(2)
							$("#Waterfall").append(itemplane);
				}
				zwydSkip += data.length
			}
		})
		row++;

	
		
		$("#Waterfall img:last").load(function(){//添加$("#Waterfall img:last").load()在这里是为了防止火狐浏览器第一次加载页面时显示不正常。
			$('#Waterfall').BlocksIt({
				numOfCol: num,
				offsetX: 10,
				offsetY: 8,
				blockElement:"div"
			});
		});
	}

		ADDItems();
	$("#Word").css("display","none");
	
	$(window).resize(function(){
		var windowWidth=$(window).width();
		if(windowWidth<=1280){
			$("#Waterfall").css({"width":"928px"});
			num=3;
			
		}else{
			$("#Waterfall").css({"width":"1236px"});
			num=4;
		}
		$("#Waterfall img:last").ready(function(){//添加$("#Waterfall img:last").load()在这里是为了防止火狐浏览器第一次加载页面时显示不正常。
			$('#Waterfall').BlocksIt({
				numOfCol: num,
				offsetX: 10,
				offsetY: 8,
				blockElement:"div"
			});
		});
	});
});
</script>
</head>
<body>

<div class="header"><img src="/w/1/images/header.jpg"/></div>
<div class="title">
	<a class="ml20 mr50" title="最新评论" href="#"><img src="/w/1/images/btn.png" alt="最新评论"/></a>
	<a class="mr50" title="最热评论" href="#"><img src="/w/1/images/btn2.png" alt="最热评论"/></a>
	<a class="mr50" title="总评论" href="#"><img src="/w/1/images/btn3.png" alt="总评论"/></a>
</div>

<div class="box" id="Waterfall">
	<center class="word pt20" id="Word"><img src="/w/1/images/sign4.gif" align="absmiddle" class="mr5 ">数据加载中请稍后...</center>



</div>

</body>
</html>
