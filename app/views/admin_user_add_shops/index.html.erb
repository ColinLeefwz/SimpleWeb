<div class="title1 mb30">
  <h2 class="f18">地点创建查看</h2>
</div>


<%= form_tag '/admin_user_add_shops',:method =>:get, class: "form-inline" do %>
  <div class="form-group">
    <span>商家名称:</span>
    <%= text_field_tag :name, nil, class: "form-control" %>
  </div>
  <div class="form-group">
    <span>地点类型：</span>
    <%= select_tag :t, options_for_select(import_t, params[:t]), class: "form-control", id: nil %>
  </div>
  <div class="form-group">
    <span>操作结果：</span>
    <%= select_tag :flag, options_for_select([['全部','0'],['审核通过','1'],['标记删除','2']], params[:flag]), class: "form-control"  %>
  </div>
   <div  class="form-group">
     <%= submit_tag "查 找", class: "btn9 r mr20" %>
  </div>
<% end %>

<table cellspacing="0" cellpadding="0" class="tab2 mt40 f13 agent_tab">
  <tr id="Tr0">
    <th width="150">商家ID</th>
    <th width="200">商家名称</th>
    <th width="120">报错人ID</th>
    <th width="150">地点类型</th>
    <th width="200">操作结果</th>
    <% if session[:city_code].nil? %>
      <th width="120">查看</th>
    <% end %>
  </tr>

  <% @shops.each do |shop| %>
    <tr>
      <td valign="middle"><%= shop.id %></td>
      <td valign="middle">
        <% if session[:city_code].present? %>
          <%= shop.name %>
        <% else %>
          <%= link_to shop.name, "admin_shops/show?id=#{shop.id}" %>
        <% end %>
      </td>
      <td valign="middle">
        <% if session[:city_code].present? %>
          <%= shop.user_name %>
        <% else %>
          <%= link_to shop.user_name, "admin_users/show?id=#{shop.user_id}" %>
        <% end %>
        <%= "(可信)" if $redis.sismember('KxUsers', shop.user_id)%>
        <%= "(授权)" if $redis.sismember('CoUsers', shop.user_id) %>
      </td>
      <td valign="middle"><%= shop.show_t %></td>
      <td valign="middle">
        <%= thand(shop) %>
      </td>
      <% if session[:city_code].nil? %>
        <td valign="middle"><%= link_to '查看', "/admin_user_add_shops/show?id=#{shop.id} "%></td>
      <% end %>
    </tr>
  <% end %>
</table>
<%= generate_paginate3.html_safe %>
<script type="text/javascript">
  $(function(){
    $(".ignore-link").click(function(event) {
      /* Act on the event */
      if(!confirm("确定忽略？")) {
        event.preventDefault();
      }
    });

    $(".delete-btn").click(function(event) {
      if(!confirm("确定删除？")) {
        event.preventDefault();
      }
    })
  })

</script>

<!-- <table border="1">
  <tr>
    <th>id</th>
    <th>名称</th>
    <th>区号</th>
    <th>创建者</th>
    <th>创建时间</th>
    <% if params[:flag].in?(["0",'1','2','3']) %>
      <th>处理方式</th>
    <% end %>
    <th></th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

  <% @shops.each_with_index do |shop, index| %>
    <tr id="shop<%=shop.id.to_i %>">
      <td><%= shop.id.to_i %></td>
      <td><%=link_to shop.name||'', "/admin_shops/show?id=#{shop.id}" %></td>
      <td><%= shop.city_fullname %></td>
      <td><%=link_to shop.user.try(:name)||'', "/admin_users/show?id=#{shop.creator}" %></td>
      <td><%= shop.first_checkin_time if index==0 || index==9%></td>
      <% if params[:flag].in?(["0",'1','2','3']) %>
        <td><%= thand(shop) %></td>
      <% end %>

      <td><%= link_to '处理', "/admin_user_add_shops/show?id=#{shop.id.to_i}", :target => "blank"  unless shop.i%></td>
      <td><%= link_to '标记删除', "#", :onclick => "ajaxDel('#{shop.id.to_i}', $(this))" unless shop.i %></td>
      <td><%= link_to '忽略', "#", :onclick => "ajaxIg('#{shop.id.to_i}', $(this))" unless shop.i %></td>
      <td><%= link_to '直接删除', "#", :onclick => "ajaxDes('#{shop.id.to_i}', $(this))" unless shop.i %></td>
    </tr>

  <% end %>
</table>
<br />
<br />
<%= generate_paginate3.html_safe %>
<br /> -->



<script type="text/javascript">
  function rmshop(sid){
    $('#shop'+sid).remove()
  }

  function ajaxDel(sid, obj){
    if(confirm("确定标记删除？"))
      $.get("/admin_user_add_shops/del",{id: sid})
  }

  function ajaxDes(sid, obj){
    if(confirm("确定直接删除？"))
      $.get("/admin_user_add_shops/des",{id: sid}, function(data){
        if(data)
          obj.parent().parent().remove()
        else
          obj.replaceWith("不能删除")
      })
  }

  function ajaxIg(sid, obj){
    if(confirm("确定忽略？"))
      $.ajax({url: "/admin_user_add_shops/ignore",
        type: 'get',
        data: {id: sid},
        dataType:'json',
        success: function(){obj.replaceWith('已忽略')}
      })
  }

</script>

