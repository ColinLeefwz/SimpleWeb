<div class="title1 mb30">
  <h2 class="f18">地点报错管理</h2>
</div>
<table width="100%" cellspacing="0" cellpadding="0" class="tab2 mt40 f13 agent_tab">
  <tr id="Tr0">
    <th width="150">商家ID</th>
    <th width="200">商家名称</th>
    <th width="120">报错人</th>
    <th width="150">报错类型</th>
    <th width="200">描述信息</th>
    <th width="150">推荐操作</th>
    <th width="90">误报</th>
    <% unless session[:city_code] %>
      <th width="120">查看</th>
    <% else %>
      <th width="120">上报</th>
    <% end %>
  </tr>

  <% @shop_reports.each do |report| %>
    <tr>
      <td valign="middle"><%= report.sid %></td>
      <td valign="middle">
        <% if session[:city_code].present? %>
          <span class="shopname"><%= report.shop_name %></span>
        <% else %>
          <%= link_to report.shop_name, "/admin_shops/show?id=#{report.shop_id}" ,class: "shopname" %>
        <% end %>
      </td>
      <td valign="middle">
        <% if session[:city_code].present? %>
          <%= report.user_name %>
        <% else %>
          <%= link_to report.user_name, "/admin_users/show?id=#{report.user_id}"%>
        <% end %>
        <%= "(可信)" if $redis.sismember('KxUsers', report.user_id)%>
        <%= "(授权)" if $redis.sismember('CoUsers', report.user_id) %>
      </td>
      <td valign="middle"><%= report.type %></td>
      <td valign="middle"><%= report.des %></td>
      <td valign="middle">
        <% if report.untreated? %>
          <%= link_to report.recommend_operation[:operation], report.recommend_operation[:url], class: "#{'delete-btn' if report.recommend_operation[:operation] == '删除地点'}" %>
        <% else %>
          <%= report.report_flag %>
        <% end %>
      </td>
      <td valign="middle" id="error_push">
        <% if report.untreated? %>
          <%= link_to '忽略', "/admin_user_reports/ignore?report_id=#{report.id}", class: "ignore-link" %>
        <% else %>
          <%= report.report_flag %>
        <% end %>
      </td>
      <% unless session[:city_code] %>
        <td valign="middle"><%= link_to '查看', "/admin_user_reports/show?id=#{report.id} "%></td>
      <% else %>
        <td valign="middle"><%= link_to '上报', "/admin_user_reports/reported?id=#{report.id}", class: "report-btn" %></td>
      <% end %>
    </tr>
  <% end %>
</table>
<div class="filter2" id="filter2">
  <div class="tips-d2">
    <div class="tips-title"><span>提示</span></div>
    <div class="m-tips-msg">
      <p>确定忽略地点报错？</p>
      <span>（注：忽略地点报错,此操作无法撤销!）</span>
    </div>
    <div class="tips-state">
      <a href="javascript:;" class="tips-btn tips-btn-a1" id="Apply_btn">确定</a>
      <a href="javascript:;" class="tips-btn tips-btn-a2" onclick="fil_close('filter2')">取消</a>
    </div>
  </div>
</div>
<%= generate_paginate3.html_safe %>
<script type="text/javascript">
  $(function(){
    $(".ignore-link").click(function(event) {
      var flag = false;
      var shopname = $(this).parent().parent().find('.shopname').text();
      $('.m-tips-msg').find('p').html('确定忽略此商家('+shopname+')地点报错？');
      $('.m-tips-msg').find('span').html('（注：忽略地点报错,此操作无法撤销!）');
      $('#filter2').show();
      var ahref = $(this).attr('href');
      $('#Apply_btn').attr('href',ahref)
      return flag;
    });

    $(".delete-btn").click(function(event) {
      var flag = false;
      var shopname = $(this).parent().parent().find('.shopname').text();
      $('.m-tips-msg').find('p').html('确定删除此商家('+shopname+')地点报错？');
      $('.m-tips-msg').find('span').html('（注：删除地点报错,此操作无法撤销!）');
      $('#filter2').show();
      var ahref = $(this).attr('href');
      $('#Apply_btn').attr('href',ahref)
      return flag;
    });

    $(".report-btn").click(function(event) {
      var flag = false;
      var shopname = $(this).parent().parent().find('.shopname').text();
      $('.m-tips-msg').find('p').html('确定上报此商家('+shopname+')地点报错？');
      $('.m-tips-msg').find('span').html('（注：上报地点报错,此操作无法撤销!）');
      $('#filter2').show();
      var ahref = $(this).attr('href');
      $('#Apply_btn').attr('href',ahref)
      return flag;
    });
  })
  /**取消**/
  function fil_close(id){
    var abtn = document.getElementById(id);
    abtn.style.display = 'none';
  }
  function rename(obj){
    var shopname = $(obj).parent().parent().find('.shopname').text();
    return shopname;
  }
</script>
