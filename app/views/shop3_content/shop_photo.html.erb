<% content_for :ahead do %>
  <script src="/newbackstage/js/jquery.blocksit.min.js"></script>
<% end %>

<div class="con">
  <div class="title1 mb30"><h2 class="f18">内容管理</h2></div>
  <div class="submenu">
    <ul>
      <li><a href="user_photo">用户图片</a></li>
      <li class="hover"><a href="shop_photo">商家图片</a></li>
      <li><a href="gchat">管理聊天室</a></li>
    </ul>
    <div class="r wordstyle">

      <form action="" method="post">
        <!--
        <select name="select" class="p3 r mr10">
          <option value="显示全部图片">显示全部图片</option>
          <option value="只显示用户图片">只显示用户图片</option>
          <option value="只显示商家图片">只显示商家图片</option>
        </select>
        -->
        <a href="new_photo" class="btn8 r mr10">上传照片</a>
      </form>
    </div>
  </div>
  <div class="clear1"></div>
  <div class="box9" id="Waterfall">
    <% @photos.each_with_index do |photo, index| %>
      <div class="box9plane">
        <%= image_tag Photo.img_url(photo.id)+"?time=#{Time.now}" %>
        <div class="m"><span><%= link_to(photo.desc.to_s.truncate(20), "/shop3_content/show_photo?id=#{photo.id}") %></span></div>

        <div class="bj">
          <%= link_to "", "/shop3_content/show_photo?id=#{photo.id}&flag=shop", :class => "n1 photolinkcon", :title => '详情' %>
          <% if photo.od %>
            <a  class="n2_1 photolinkcon" onclick="ajaxUOT(this, '<%= photo.id %>' )" title="取消置顶"></a>
          <% else %>
            <a  class="n2 photolinkcon" onclick="ajaxUOT(this, '<%= photo.id %>' )" title="置顶"></a>
          <% end %>

          <%= link_to "", "/shop3_content/edit_photo?id=#{photo.id}", :class => "n3", :title => "编辑" %>
          <%= link_to "", "javascript:void(0)", :title => "删除", :class => "n6 link_ns", :rel=> index, :photo_id => photo.id %>
        </div>
      </div>
    <% end %>


  </div>
  <%= generate_paginate.html_safe %>
</div>
<script defer="defer">
  var navmove="off", runing, noing="run";
  $(document).ready(function(){
    runing=$("#CB1").attr("class");
    ua=navigator.userAgent.toLowerCase();

    $('#Waterfall').BlocksIt({
      numOfCol: 5,
      offsetX: 5,
      offsetY: 5,
      blockElement: 'div'
    });

    if(runing=="checkboxs1"){
      NavDiv();
      Photo();
      $(window).load(function(){
        MessageDiv();
      });
      noing="norun";
    }else if(runing=="checkboxs2"){
      AllNoDH();
    }

    if(/ipad/i.test(ua)){
      $("div.box9plane").click(function(){
        var obj=$(this);
        obj.find("div.m").fadeIn(300);
        obj.find("div.bj").animate({"bottom":"0px"},300);
        setTimeout(function(){
          obj.find("div.m").fadeOut(300);
          obj.find("div.bj").animate({"bottom":"-25px"},300);
        },3000);
      });
    }else{
      $("div.box9plane").hover(
      function(){
        $(this).find("div.m").fadeIn(300);
        $(this).find("div.bj").animate({"bottom":"0px"},300);
      },
      function(){
        $(this).find("div.m").fadeOut(300);
        $(this).find("div.bj").animate({"bottom":"-25px"},300);
      }
    );
    }

    $("div.bj a.n5").parents("div.box9plane").addClass("opacity_55");
    $("div.bj a.n5").parents("div.box9plane").find(".photolinkcon").hide()

    /*	$("#Close").click(function(){
                $("#PhotoPlane,#BG").css("display","none");
        });*/

    $("div.box9plane a.n6").click(function(){

      if(confirm("确定删除？")){
        var photo_id = $(this).attr("photo_id")
        var x,y,rel;
        rel=parseInt($(this).attr("rel"));
        $.get("/shop3_content/delete_photo.json", {id: photo_id}, function(){
          $("div.box9plane").stop(true,true);
          
          x=$("div.box9plane").eq(rel).css("left"); y=$("div.box9plane").eq(rel).css("top");
          $("div.box9plane").eq(rel).remove();
          for(i=rel;i<$("div.box9plane").length;i++){
            $("div.box9plane").eq(i).animate({"left":x,"top":y},300);
            x=$("div.box9plane").eq(i).css("left");
            y=$("div.box9plane").eq(i).css("top");
          }
          
          for(i=0; i<$("a.link_ns").length; i++){
            $("a.link_ns").eq(i).attr("rel",i);
          }
         
        })
      }
    });
    




  });
  /*function OpenDiv(){
        var top;
        documentHeight=$(document).height();
        windowHeight=$(window).height();
        if(documentHeight<=windowHeight){
                $("#BG").css({"height":windowHeight+"px","display":"block"});
        }else{
                $("#BG").css({"height":documentHeight+"px","display":"block"});
        }
        $("#PhotoPlane").css("display","block");
        top=$(document).scrollTop()+(windowHeight-$("#PhotoPlane").height())/2;
        $("#PhotoPlane").css({"top":top+"px","display":"none"});
        $("#PhotoPlane").fadeIn(600);
}*/
  function OC(obj, id){
    if(confirm("确定"+$(obj).attr("title"))){
      if($(obj).attr("class")=="n4"){
        $.get("/shop3_content/ajax_del", {id: id}, function(){
          $(obj).removeClass().addClass("n5").attr("title","显示");
          $(obj).parent().addClass("bbj");
          $(obj).parent().siblings().addClass("bm");
          $(obj).parents("div.box9plane").addClass("opacity_55");
          $(obj).parents("div.box9plane").find(".photolinkcon").hide()
        })
      }else{
        $.get("/shop3_content/ajax_undel", {id: id}, function(){
          $(obj).removeClass().addClass("n4").attr("title","隐藏");
          $(obj).parent().removeClass("bbj");
          $(obj).parents("div.box9plane").find(".photolinkcon").show()
          $(obj).parent().siblings().removeClass("bm");
          $(obj).parents("div.box9plane").removeClass("opacity_55");
        })
      }
    }
  }

  function ajaxUOT(obj, id){
    var text = $(obj).attr("title")
    if(confirm("确定"+ text)){
      if(text == "置顶")
        $.get("/shop_photos/ajax_top", {id: id}, function(){ $(obj).removeClass("n2").addClass('n2_1').attr("title","取消置顶");})
      else
        $.get("/shop_photos/ajax_untop", {id: id}, function(){$(obj).removeClass("n2_1").addClass('n2').attr("title","置顶"); })
    }
  }

</script>
