
	
关于脸脸地点库管理和维护
=============

##目前的状况

###脸脸地点的数据来源

脸脸网总体上分为三大部分：

* 原来购买的百度和谷歌地点库，海外使用的是OpenStreetMap
* 脸脸用户添加的地点
* 脸脸城市运营商添加的地点


###日常数据审核和整理

* 用户添加地点处理
* 用户报错地点处理
* 相似地点处理
* 大地点管理

###目前的问题
* 原来购买的百度和谷歌地点库已经陈旧
* 大地点的管理每个都需要人工设置，且过程麻烦
* 未利用城市运营商的力量
* 未利用脸脸用户的力量

###可借鉴的
* OpenStreetMap如何建立地点库
* Foursquare如何建立地点库
* 大众点评如何建立地点库

###设想的解决措施
* 能否有渠道购买新的百度／高德地点库
* 大地点管理设置面积
* 把地点的审核和整理权限开放给城市运营商，计划在月底完成相关开发工作
* 利用积分／荣誉体系激励脸脸用户完善地点
* 利用爬虫收集和分析百度／高德的地点库




##地点库模型和技术处理

地点库的核心是地点名称、类型、经纬度、与其它地点关系。其它可选属性包括电话、地址、Logo等，签约商家要提供这些属性。下一阶段希望能够收集的属性包括：营业时间、公交线路、平均消费等数据。

###地点的类型

地点类型分为内部类型，外部类型。内部类型对外不可见，主要用于地点的详细分类。目前的内部类型有：
		
		0 活动
		1 酒吧
		2 咖啡
		3 茶馆
		4 餐饮
		5 酒店
		6 休闲娱乐
		7 运动
		8 购物
		9 广场
		10 写字楼
		11 住宅
		12 学校
		13 交通
		14 大型医院
		15 景点
		51 美容美发
		52 公司
		53 其他
如果一个地点没有内部类型，那么在定位时不会出现在前5的位置。比如需要在滚轮中出现，但是又不属于已有分类的全部归入其他分类。

地点的外部类型用于在脸脸展示以及运营。最初脸脸客户端展示给用户的、可以让用户按类型搜索的商家分类如下：

		1.酒吧• 活动
		2.咖啡• 茶馆   
		3.餐饮• 酒店
		4.休闲• 娱乐
		5.购物• 广场
		6.楼宇• 社区

现在脸脸运营则区分商家为B1类和B2类商家。

在进行数据整理时，地点的类型都要使用内部类型。如果内部类型不能支撑运营的需要，则需要扩充内部类型。

###地点的关系
在数据层，地点的关系有两类：大地点／子地点、主店／分店。

大地点和子地点关系必须是子地点真实在大地点里面。

主店和分店则要求必须是同一个商家，物理位置独立的不同的店。

###地点的经纬度
脸脸根据经纬度来确定当前的位置和商家。如果一个地点比较大，经纬度可以有多个。一般情况下大厦可以有两个经纬度、小区可以有四个经纬度，车站／学校／大型商场等可以有10个以上的经纬度。

当一个大地点添加子地点时，子地点的经纬度也会自动并入大地点的经纬度。

作为地点数据的管理人员，则需要知道经纬度坐标有三种：真实的GPS经纬度、国家测绘局的混淆后经纬度（GCJ）、百度混淆后经纬度（bd09-2）。

苹果手机报告的经纬度是真实的GPS坐标，高德／谷歌／SOSO地图使用的是GCJ坐标，百度地图使用的是百度坐标。


###地点初始建库
脸脸最初的国内地点库是混合了百度和高德的地点数据。其中的重复地点，按照相似度把相似度高的提前过滤了。相似度算法综合考虑了地点的位置、名称、类型、地址等参数。剩下的比较模糊的难以判断是否重复的地点，则由运营部门按城市整理。

在最初建库时，已经根据地点名称和地址自动合并了地点的经纬度。典型的合并模式有三种，

第一种如：
		
	XX大厦 XX大厦停车场
	XX大厦 XX大厦（ABCD）座
	XX小区 XX小区（东西南北）门／区
	XX小区 XX小区（XX）幢／楼／条

对于第一类，把子地点的经纬度加入大地点，并删除子地点。

第二种如：

	XX大学 XX大学XX楼
	XX机场 XX机场XX航站楼

对于第二类，把子地点的经纬度加入大地点，也把子地点的关系加入到大地点。

第三种如：

	XX地点  YY品牌（XX地点店）

对于第三类，把子地点的经纬度加入大地点，子地点不变。


###地点库更新
我们原始导入的百度数据的格式如下：

{"addr" : "新疆维吾尔自治区阿勒泰地区富蕴县", "city" : "0906", "lob" : [ 46.4156249416693, 88.6996865581467 ], "name" : "红海饭庄", "phone" : "", "type" : "餐饮;中餐馆" }

我们原始导入的谷歌数据的格式如下：

{ "city" : "0454", "name" : "美的净水机", "addr" : "", "tel" : "0454-8549666", "type" : "购物服务;家电电子卖场;家电电子卖场", "loc" : [ 46.806552, 130.360679 ]}

百度和谷歌的类型体系都是独立的，经纬度也是各自坐标的。

由于没有数据在百度的实际ID，当导入百度新的数据时，要按照名称、经纬度、地址等去重，从而得出本次导入新增的数据和删除的数据。地点导入会比原来的百度／谷歌比对去重要精确的多。


##目前的一些数据

初始导入的百度数据20275139，谷歌数据14810371。目前脸脸地点总数量11866374。

全国按区号有366个城市，比如杭州／萧山／富阳的区号都是0571，在脸脸里算一个城市。

目前后台提供的需要整理的相似地点的城市96个，地点数据198424。运营已整理的城市数据是37个,地点数据168099。



##脸脸地点整理
###机制

###团队与任务
涉及到三个团队：技术、运营和销售。各个部门的责任包括：
技术：地点整理工具的研发、技术支持。
运营：日常地点审核工作，包括用户添加地点审核、报错地点审核、重复地点处理、大地点处理。
销售：客户地点建立与信息完善、扫街完善商家数据。

###任务
商家开通时的地点处理流程：
1. 销售人员确保在现场用脸脸进入该商家地点，如果没有则建立地点。目前销售人员往往是自己在公司建立地点，或者让技术支持人员通过查找地图的方式建立地点，这是不合理的。
2. 销售人员在该地点拿到地点的ID（进入现场输入@@@id即可获得商家ID），然后通知支持人员开通商家的脸脸和即立方等帐号。

日常扫街流程：
扫街时要保证wifi／gps都处于打开状态。
进入每一个地点，用脸脸定位后进入现场。照片墙没有图的发一到两张图。
如果定位时找不到，打开百度地图，看位置是否准确。
定位准确时，通过搜索找到地点，然后进入现场。
定位准确时，通过搜索找不到地点，则要创建地点。




###软件工具
脸脸客户端：地点报错 、 添加地点
脸脸管理后台：用户添加地点审核、报错地点审核、重复地点处理、大地点管理、分店管理。
即立方后台：可以对运营商开放用户添加地点审核、报错地点审核

###评估
1. 重点商家在现场时定位在前3位；
2. 普通商家在现场时定位滚轮种能出现；

