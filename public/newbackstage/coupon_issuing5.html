<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>脸脸茶坊欢迎您</title>
	<link href="/newbackstage/css/public.css" rel="stylesheet" type="text/css" />
	<link href="/newbackstage/css/jquery.Jcrop.css" rel="stylesheet" type="text/css" />
	<!--[if IE]>
	<link href="/newbackstage/css/ie.css" rel="stylesheet" type="text/css">
	<![endif]-->
	<script src="/newbackstage/js/jquery-1.6.2.min.js"></script>
	<script src="/newbackstage/js/public.js" type="text/javascript"></script>
	<script src="/newbackstage/js/jquery.Jcrop.js"></script>
</head>
<body>
	<div class="main">
		<div class="header">
			<div class="headercon">
				<div id="Message">赵海斌刚刚使用了一张分享优惠券惠券</div>
				<div class="toptitle"><h1>脸脸茶坊</h1></div>
			</div>
			<img src="/newbackstage/images/pic1.png" class="logo" id="OpenLinkBox"/>
			<img src="/newbackstage/images/line.png" class="sign" id="OpenNav" title="打开导航菜单"/>
			<div id="LinkBox">
				<a href="http://www.dface.cn" class="links1" target="_blank">脸脸首页</a>
				<a  class="links2">退出</a>
				<span class="linkarrow"></span>
			</div>
		</div>
		<div id="Nav">
			<a class="sign" id="CloseNav"></a>
			<div id="Navcon">
				<a href="/newbackstage/index.html">首页</a>
				<span class="navline"></span>
				<a href="coupon_data_stistics4.html">优惠券管理</a>
				<span class="navline"></span>
				<a href="/newbackstage/data_statistics1.html">数据统计</a>
				<span class="navline"></span>
				<a href="content_manage1.html">内容管理</a>
				<span class="navline"></span>
				<a href="sign_manage1.html">签到管理</a>
				<span class="navline"></span>
				<a href="seller_set1.html">商家设置</a>
				<span class="navline"></span>
				<a href="/newbackstage/questions_answers1.html">问答系统</a>
				<span class="navline"></span>
				<label id="CB1" class="checkboxs1" style="display:none">取消动画</label>
				<span class="navline"></span>
				<a id="Btn"><img src="/newbackstage/images/sign1.png" align="absmiddle"/> 固定左侧导航</a>
			</div>
		</div>
		<div id="BG"></div>
		<div class="clear1"></div>
		<a name="a1"></a>
		<div class="con2">
			<div class="title1"><h2 class="f18">发布优惠券</h2></div>
			<div class="box5">签到优惠券， 图文混排格式  <a href="/newbackstage/coupon_manage.html" class="blue1 pl20 f12">选择其他优惠券模式</a></div>
			<div id="UpImg">
				<div class="upimgplane">
					<div class="upimgtab">
						<span id="EM"><img id="UploadPic" src="images/btn9.jpg" onClick="ImageUpload('UpImgFile')"/></span><input type="file" id="UpImgFile" class="filebox6" onClick="ImageUpload(this)"/><input type="file" id="UpImgFile" class="filebox7" onClick="ImageUpload(this)"/><input type="file" id="UpImgFile" class="filebox8" onClick="ImageUpload(this)"/><input type="file" id="UpImgFile" class="filebox9" onClick="ImageUpload(this)"/><input type="file" id="UpImgFile" class="filebox10" onClick="ImageUpload(this)"/><input type="file" id="UpImgFile" class="filebox11" onClick="ImageUpload(this)"/>
					</div>
				</div>
				<div id="SmallImgDiv"  class="cnm">
					<img src="images/pic23.jpg" class="jcrop-preview"/>
				</div>
				<div class="upimgdiv">
					<input type="file" onclick="ImageUpload(this)" class="filebox14 none" id="UpImgFile">
					<input type="file" onclick="ImageUpload(this)" class="filebox15 none" id="UpImgFile">
					<input type="button" onclick="ImageUpload('UpImgFile')" value="重新上传" class="btn19 l none" id="Btn19">
					<a onclick="NoCut()" class="btn3 r" href="#a1">取消</a>
					<input type="button" id="Btn2" class="btn2 r mr10" value="提 交"/>
				</div>
			</div>
			<div class="clear1"></div>
			<form method="post" action="" id="Forms">
				<div class="box6 visible">
					<div class="box6message" id="Box6Message">报错提示</div>
					<div class="boxinner">
						<a class="btn4" style="background:url(images/pic6.jpg) left top no-repeat;"></a>
						<div class="box6right1">
							<input type="text" class="inputs2" value="优惠券主题 不得超过13个文字">
							<textarea class="textarea3">优惠额度，使用规则、期限等，不超过90字</textarea>
						</div>
					</div>
					<div class="box6number">X-XXXX</div>
					<div class="box6date">XXXX-XX-XX&nbsp;&nbsp;XX:XX</div>
				</div>
				<div class="clear1"></div>
				<div class="box7">
					<div class="box7plane1">
						<label>发放规则</label>
						<select name="select" class="ptb2 plr3">
							<option value="0">每日签到优惠</option>
							<option value="1">每日前几名签到优惠</option>
							<option value="2">新用户首次签到优惠</option>
							<option value="3">累计签到优惠</option>
						</select>
					</div>
					<div class="box7plane1">
						<label>前&nbsp;几&nbsp;名</label>
						<input type="text" class="inputs4"/>
					</div>
					<div class="box7plane1">
						<label>使用流程</label>
						<select name="select" class="ptb2 plr3">
							<option selected="selected" value="0">展示优惠券，点击后既代表使用了</option>
							<option value="1">展示优惠券，点击后按要求输入内容，然后确定使用</option>
						</select>
					</div>
					<div class="box7plane1">
						<label>使用时输入内容提示</label>
						<input type="text" class="inputs4 w235"/> <span class="f13 green2 ml10">例: 请输入此次消费的金额/请输入您的桌号/请输入您的手机号码</span>
					</div>
					<div class="box7plane1 pt30 mb50">
						<input type="submit" name="Submit" value="保 存" class="btn2 l"/>
                        <a class="btn3 l ml20" href="/newbackstage/coupon_manage.html">取 消</a>
					</div>
				</div>
			</form>
		</div>
	</div>
<script defer="defer">
var navmove="on", runing;
$(document).ready(function(){
	runing=$("#CB1").attr("class");
	if(runing=="checkboxs1"){
		NavDiv();
		$(window).load(function(){
			MessageDiv();
		});
	}else if(runing=="checkboxs2"){
		AllNoDH();
	}
	$("a.btn4").click(function(){
		$("#UpImg").css("top","42px").slideDown(600);
		var documentHeight=$(document).height();
		var windowHeight=$(window).height();
		if(documentHeight<=windowHeight){
		  $("#BG").css({"height":windowHeight+"px","display":"block"});
		}else{
		  $("#BG").css({"height":documentHeight+"px","display":"block"});
		}
	});
});

</script>

<script type="text/javascript">
var emObj, sidObj;
$(document).ready(function(){
	emObj=$("#EM").html()
	sidObj=$("#SmallImgDiv").html();
});
function ImageUpload(target){//优惠券
		
	var obj , pic , sid;
	if(target=="UpImgFile"){
		obj=document.getElementById(target);
	}else{
		obj=target;
	}
	
	
	pic=document.getElementById("UploadPic");
	sid=document.getElementById("SmallImgDiv");
	obj.click();//打开上传对话框
	obj.onchange=function(){
		$("#Btn19").removeClass("none");
		if(/msie/i.test(ua)){//IE浏览器可以直接取值
			this.select();
			this.blur();
			var path=document.selection.createRange().text;
			path = "file:///" + path.replace(":",'|');
			path = path.replace(/\\/g,'/');
			document.selection.empty();
			$(".filebox6, .filebox7, .filebox8, .filebox9, .filebox10, .filebox11").css({"display":"none"});
			$(".filebox14, .filebox15").removeClass("none");
		}else{//火狐、谷歌、Opera、需要通过生成FileReader()来专门实现图片显示
			
			var reader = new FileReader();
			reader.readAsDataURL(obj.files[0]);
			reader.onload = function(e){
				$("#EM").html("<img id='UploadPic' src='"+this.result+"' />");
				pic.src=this.result;
				sid.innerHTML="<img src=\'"+$("#UploadPic").attr("src")+"\' />";

				$("#UploadPic").load(function(){
						var cut = new ImgCut({
						  viewClass: 'cnm',  //初始化 大中小图片预览区域及个数，DOM结构决定
						  imgId: 'UploadPic',
						  bgColor: 'black',           //初始化 背景颜色
						  bgFade: true,              //初始化 背景渐变效果
						  shade: false,              //初始化 选区是否显示黑白效果
						  bgOpacity: 0.3 ,            //初始化 背景透明度
						  addClass: 'jcrop-light' ,   //初始化 选区边界凸效果
						},
					   
						function (cutObj) {
							var w=$("#UploadPic").width();
							var h=$("#UploadPic").height();
							
							var w1=100,h1,w2=252,h2=252;
							if(h<252){
								$("#EM").css("margin-top",(400-h)/2+"px");
								h1=(400-h)/2;w1=0;
							}else if(h<400&h>252){
								$("#EM").css("margin-top",(400-h)/2+"px");
								h1=(400-252)/2;	
								w1=(h-252)/2;
								w2=252+w1;h2=252+h1;
							}else if(h>400){
								$("#EM").css("margin-top","0px");
								h1=(400-252)/2;	
								w2=252+w1;h2=252+h1;
							}else if(h==400){
								$("#EM").css("margin-top","0px");
								h1=(400-252)/2;
								w1=h1
								w2=252+w1;h2=252+h1;
							}
						  cutObj.getApi().animateTo([h1, w1, h2, w2]);
						  cutObj.getApi().ui.selection.addClass('jcrop-selection');
						}
						);
						
						$("#Btn2").click(function () {
						var result = cut.getResult() ;
						var str = '返回值如下：\n\n' ;
						for (obj in result) {
						  str += obj + '：' + result[obj] + '\n' ;
						}
						alert(str) ;
						$("#UpImg,#BG").css("display","none");
					  });
				});

			}
		}
	}
}
				
function NoCut(){
	$("#UpImg").animate({"top":"-722px"},750,function(){
		$("#BG").css("display","none");		
	});
	$("#UpImgFile").val("");
	$("#EM").html(emObj).removeAttr("style");
	$("#SmallImgDiv").html(sidObj);
	if(/msie/i.test(ua)){
		$(".filebox6, .filebox7, .filebox8, .filebox9, .filebox10, .filebox11").css({"display":"block"});
	}
	var path=$("#EM img").attr("src");
	if(path="images/btn9.jpg"){
		$("#Btn19").addClass("none");
		$(".filebox14, .filebox15").addClass("none");
	}
}

function ImgCut(options, callback) {
  var 
    _class  = ImgCut ,
    _ops    = options
  ;

  if (!$.isPlainObject(options)) {
    return false ;
  }

  this.bounds = [] ;
  this.result = {} ;
  this.api    = {} ;
  this.$img   = $('#' + _ops.imgId) ;
  this.$view  = $('.' + _ops.viewClass).size() ? $('.' + _ops.viewClass) : false ;

 if (typeof _class._initialized === 'undefined') {
    var methods = {
      //初始化
      init : function () {
        this.setResult() ;
        this.jCrop() ;
      },

      //创建jCrop对象
      jCrop : function () {
        var that = this ;
        var options = {
          onChange: function (c) {
            $.extend(that.result, c) ;
            if (parseInt(c.w) > 0 && that.$view) {
              function view($div, width, height) {
                var rx = width / c.w ,
                    ry = height / c.h ;
                $div.find('img').css({
                  width      : Math.round(rx * that.bounds[0]) + 'px' ,
                  height     : Math.round(ry * that.bounds[1]) + 'px' ,
                  marginLeft : '-' + Math.round(rx * c.x) + 'px' ,
                  marginTop  : '-' + Math.round(ry * c.y) + 'px'
                }) ;
              }
              that.$view.show().each(function () {
                view($(this), $(this).width(), $(this).height()) ;
              }) ;
            }
          } ,
          onSelect: this.onChange ,
          aspectRatio: 1
        }

        $.extend(options, _ops) ;

        return this.$img.Jcrop(options,
          //loader后this被创建
          function () {
            this.focus() ;
            that.api = this ;
            that.bounds = this.getBounds() ;
            //释放本类实例对象
            $.isFunction(callback) && callback(that) ;
        }) ;
      },

      //修改图片时且同步缩略图预览时调用
      //已包装jcrop.setImage(url, callback)，有缩略图预览时必须掉此方法
      setViewImg : function (url, callback) {
        var 
            that = this ,
            url = url + '?ver=' + (new Date()).getTime() ,
            minSize = that.api.getOptions().minSize ,
            img = new Image()
        ;

        img.onload = function () {
          if (this.width >= minSize[0] && this.height >= minSize[1]) {
            that.api.setImage(url, callback) ;
            that.result.url = url ;
            that.bounds[0] = this.width ;
            that.bounds[1] = this.height ;
            that.$img.attr('src', url) ;
            that.$view && that.$view.find('img').attr('src', url) ;
          } else {
            alert('错误：被处理图片尺寸小于选区最小要求！') ;
            return false ;
          }
        }

        img.onerror = function () {
          alert('错误：图片加载失败，请重试！') ;
          return false ;
        }

        img.src = url ;
      },

      //装载与后端传递的数据
      setResult : function () {
        var that = this ;
        this.result.url = this.$img.attr('src') ;
        this.$view && this.$view.each(function (i) {
          that.result['avatar_' + (i + 1)] = [] ;
          that.result['avatar_' + (i + 1)][0] = $(this).width() ;
          that.result['avatar_' + (i + 1)][1] = $(this).height() ;
        }) ;
      },

      //获取Jcrop对象
      getApi : function () {
        return this.api ;
      },

      //获取返回值：坐标、宽度、高度、大中小图尺寸、图片路径
      getResult : function () {
        return this.result ;
      }
    }

    $.extend(_class.prototype, methods) ;
  
    _class._initialized = true ;
  }
  this.init() ; 
}
</script>
</body>
</html>